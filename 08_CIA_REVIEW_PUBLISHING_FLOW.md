# CIA Review & Publishing Flow

> **Architecture Specification**: Complete content lifecycle from import to publishing

## ğŸ“‹ Document Purpose

This document specifies the complete user journey and technical implementation for:
1. Content versioning (creating new versions from published content)
2. CIA (Content Impact Analysis) review workflow
3. Approval and publishing flow
4. Frontend-Backend integration

---

## ğŸ¯ Business Context

### Stakeholders
- **MV (Modulverantwortlicher)**: Module Manager who owns the course content, reviews CIA suggestions, and publishes

### Key Business Rules
1. **CIA suggestions are recommendations, not mandates** - MV can mark as "fixed" or "ignore"
2. **All suggestions must be handled** before publishing (either "fixed" or "ignored")
3. **MV has full autonomy** - Can review AND approve their own work (self-approval)
4. **One draft at a time** - Cannot create v3 while v2 draft exists
5. **No partial publishing** - Coursebook and KFK are published together
6. **Re-run CIA option** - MV can re-run CIA anytime if they made edits

---

## ğŸ”„ Version Lifecycle Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         COURSE VERSION LIFECYCLE                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚    FIRST IMPORT     â”‚
                        â”‚  (from legacy/S3)   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ Import creates v1 as PUBLISHED (baseline)
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              PUBLISHED (v1)                                          â”‚
â”‚                                                                                      â”‚
â”‚  This is the "source of truth" - what students currently see                         â”‚
â”‚  User can VIEW but not EDIT this version                                             â”‚
â”‚                                                                                      â”‚
â”‚  Action: [CREATE NEW VERSION]                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ User clicks "Create New Version"
                                   â”‚ System copies v1 content â†’ v2 (draft)
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              DRAFT (v2)                                              â”‚
â”‚                                                                                      â”‚
â”‚  User can freely edit content in Fonto                                               â”‚
â”‚  No restrictions, no CIA yet                                                         â”‚
â”‚                                                                                      â”‚
â”‚  Actions: [EDIT CONTENT] [START REVIEW]                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ User clicks "Start Review"
                                   â”‚ â†’ CIA runs automatically
                                   â”‚ â†’ Status changes to IN_REVIEW
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              IN REVIEW (v2)                                          â”‚
â”‚                                                                                      â”‚
â”‚  CIA has run, suggestions are displayed                                              â”‚
â”‚  User reviews each suggestion: [FIXED] [IGNORE]                                      â”‚
â”‚                                                                                      â”‚
â”‚  Progress: "15/23 suggestions handled"                                               â”‚
â”‚                                                                                      â”‚
â”‚  Actions:                                                                            â”‚
â”‚    [EDIT CONTENT] - Can still edit, but will need to re-run CIA                      â”‚
â”‚    [RE-RUN CIA] - Optional, if user made edits and wants fresh analysis              â”‚
â”‚    [APPROVE & PUBLISH] - Enabled when ALL suggestions handled                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”‚ User clicks "Approve & Publish"
                                   â”‚ â†’ Content is frozen
                                   â”‚ â†’ Publishing pipeline starts
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              PUBLISHING (v2)                                         â”‚
â”‚                                                                                      â”‚
â”‚  System uploads to Moodle + S3 (+ MyCampus future)                                   â”‚
â”‚  User sees progress indicator                                                        â”‚
â”‚  No actions available (wait)                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â”œâ”€â”€â”€ Success â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚                               â–¼
                                   â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚                 â”‚  PUBLISHED (v2)          â”‚
                                   â”‚                 â”‚  v1 â†’ ARCHIVED           â”‚
                                   â”‚                 â”‚                          â”‚
                                   â”‚                 â”‚  Cycle repeats:          â”‚
                                   â”‚                 â”‚  [CREATE NEW VERSION]    â”‚
                                   â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â””â”€â”€â”€ Failure â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                   â–¼
                                                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                     â”‚  IN_REVIEW (v2)          â”‚
                                                     â”‚  (rolled back)           â”‚
                                                     â”‚                          â”‚
                                                     â”‚  [RETRY PUBLISH]         â”‚
                                                     â”‚  [VIEW ERROR]            â”‚
                                                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š State Definitions

| Status | Description | User Can Do | System Behavior |
|--------|-------------|-------------|-----------------|
| `PUBLISHED` | Live version, students see this | View, Create new version | Read-only, serves as baseline |
| `ARCHIVED` | Previous published version | View only | Read-only, kept for history |
| `DRAFT` | Working copy, no CIA yet | Edit freely, Start review | Tracks changes |
| `IN_REVIEW` | CIA ran, reviewing suggestions | Handle suggestions, Edit, Re-run CIA, Approve & Publish | Tracks suggestion progress |
| `PUBLISHING` | Upload in progress | Wait | Pipeline executing |

### Allowed State Transitions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        STATE TRANSITION RULES                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  PUBLISHED â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º ARCHIVED
       â”‚                               (when new version published)
       â”‚
       â–¼ (Create New Version)
    DRAFT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º IN_REVIEW
       â”‚                               (Start Review â†’ runs CIA)
       â”‚
       â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                              (if user edits, re-run CIA)       â”‚
       â–¼                                                                â”‚
  IN_REVIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                                                                â”‚
       â”‚ (Approve & Publish - BLOCKED until all suggestions handled)    â”‚
       â–¼                                                                â”‚
  PUBLISHING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
       â”‚                              (failure â†’ rollback to IN_REVIEW) â”‚
       â”‚                                                                â”‚
       â–¼ (success)                                                      â”‚
   PUBLISHED                                                            â”‚
       â”‚                                                                â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| Transition | Trigger | Preconditions |
|------------|---------|---------------|
| PUBLISHED â†’ ARCHIVED | New version published | Another version reached PUBLISHED |
| PUBLISHED â†’ (new DRAFT) | "Create New Version" | No existing DRAFT for this course |
| DRAFT â†’ IN_REVIEW | "Start Review" | None (CIA runs automatically) |
| IN_REVIEW â†’ IN_REVIEW | "Re-run CIA" | None (resets suggestion list) |
| IN_REVIEW â†’ PUBLISHING | "Approve & Publish" | **ALL suggestions must be handled (fixed OR ignored)** |
| PUBLISHING â†’ PUBLISHED | Pipeline success | All targets (S3, Moodle) succeed |
| PUBLISHING â†’ IN_REVIEW | Pipeline failure | Any target fails (rollback) |

### â›” Blocked Transitions

| Blocked Action | Reason | User Message |
|----------------|--------|--------------|
| "Approve & Publish" with pending suggestions | Must handle all CIA suggestions | "Please handle all X pending suggestions before publishing" |
| "Create New Version" when draft exists | One draft at a time | "You already have a draft (v3) in progress. Finish or discard it first." |
| Edit content in PUBLISHING state | Content frozen during publish | N/A (UI hides edit action) |
| Edit content in PUBLISHED/ARCHIVED | Read-only versions | N/A (UI hides edit action) |

---

### ğŸ” Authorization

| Action | Required Role | Notes |
|--------|---------------|-------|
| View course content | Any authenticated user | Read access to assigned courses |
| Create new version | MV (Modulverantwortlicher) | Must be MV for this specific course |
| Edit content (Fonto) | MV | Must be MV for this specific course |
| Handle CIA suggestions | MV | Must be MV for this specific course |
| Approve & Publish | MV | **Self-approval allowed** - MV can approve their own work |
| Re-run CIA | MV | Must be MV for this specific course |
| Retry failed publish | MV | Must be MV for this specific course |

> **Note**: Authorization is enforced via existing Okta integration. The MV is identified by their `iuUserId` claim. Backend validates MV assignment before allowing write operations.

---

### ğŸ“¦ Version Creation Guardrails

**Rule: One Draft Per Course**

A course can have at most ONE non-published draft version at any time.

```
âœ… Allowed states for a course:
   - 1 PUBLISHED + 0 DRAFT = can create new version
   - 1 PUBLISHED + 1 DRAFT = cannot create, must finish draft
   - 1 PUBLISHED + 1 IN_REVIEW = cannot create, must finish review
   - 1 PUBLISHED + 1 PUBLISHING = cannot create, must wait

âŒ NOT allowed:
   - Multiple drafts (v3 draft + v4 draft)
   - Creating v4 while v3 is in review
```

**Base Version Selection**:
- New version is always copied from the **latest PUBLISHED** version
- Archived versions are kept for history only, not as copy source

**Discard Draft**:
- MV can discard a draft at any time (DRAFT or IN_REVIEW state)
- This deletes all copied documents and CIA suggestions for that version
- MV can then create a fresh version from the published baseline

---

## ğŸ–¥ï¸ Frontend Specification

### Page Structure

```
/course-content-review
â”‚
â”œâ”€â”€ CourseContentReviewPage (Project List)
â”‚   â””â”€â”€ Shows all courses assigned to MV
â”‚       â””â”€â”€ Each card shows: current published version + draft status (if exists)
â”‚
â”œâ”€â”€ ProjectOverviewPage (Single Course)
â”‚   â”œâ”€â”€ Version History section (published + archived versions)
â”‚   â”œâ”€â”€ Draft Version section (if exists)
â”‚   â”‚   â”œâ”€â”€ Status badge (DRAFT / IN_REVIEW / PUBLISHING)
â”‚   â”‚   â”œâ”€â”€ CIA progress (if in review)
â”‚   â”‚   â””â”€â”€ Action buttons based on state
â”‚   â””â”€â”€ [CREATE NEW VERSION] button (if no draft exists)
â”‚
â””â”€â”€ ReviewSuggestionsPage (CIA Results)
    â”œâ”€â”€ Progress indicator (X/Y handled)
    â”œâ”€â”€ Filter tabs: [Pending] [Handled] [All]
    â”œâ”€â”€ Suggestion cards with [FIXED] [IGNORE] [EDIT] actions
    â””â”€â”€ Footer: [RE-RUN CIA] [APPROVE & PUBLISH]
```

### Page 1: Project List

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  YOUR PROJECTS                                                           [Search]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ“š DLBAGRMGDS01                                                              â”‚   â”‚
â”‚  â”‚  Grundlagen der deutschen Sprachwissenschaft                                  â”‚   â”‚
â”‚  â”‚                                                                               â”‚   â”‚
â”‚  â”‚  Published: v2 (Dec 5, 2024)                                                  â”‚   â”‚
â”‚  â”‚  No draft in progress                                                         â”‚   â”‚
â”‚  â”‚                                                                   [VIEW]      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ“š MKT301                                                     [IN REVIEW]    â”‚   â”‚
â”‚  â”‚  Advanced Marketing Strategies                                                â”‚   â”‚
â”‚  â”‚                                                                               â”‚   â”‚
â”‚  â”‚  Published: v1 (Oct 15, 2024)                                                 â”‚   â”‚
â”‚  â”‚  Draft v2: 15/23 suggestions handled                                          â”‚   â”‚
â”‚  â”‚                                                                   [VIEW]      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Page 2: Project Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Back to Projects                                                                  â”‚
â”‚                                                                                      â”‚
â”‚  DLBAGRMGDS01 - Grundlagen der deutschen Sprachwissenschaft                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  CURRENT DRAFT                                               [IN REVIEW] ğŸŸ¡   â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚   â”‚
â”‚  â”‚  Version: 3                                                                   â”‚   â”‚
â”‚  â”‚  Created: Dec 8, 2024                                                         â”‚   â”‚
â”‚  â”‚  Last edited: Dec 8, 2024 14:32                                               â”‚   â”‚
â”‚  â”‚                                                                               â”‚   â”‚
â”‚  â”‚  CIA Review Progress:                                                         â”‚   â”‚
â”‚  â”‚  [=================>              ] 15/23 suggestions handled                 â”‚   â”‚
â”‚  â”‚                                                                               â”‚   â”‚
â”‚  â”‚  âš ï¸ Content edited since last CIA run                                         â”‚   â”‚
â”‚  â”‚                                                                               â”‚   â”‚
â”‚  â”‚  [EDIT CONTENT]  [REVIEW SUGGESTIONS]  [RE-RUN CIA]                           â”‚   â”‚
â”‚  â”‚                                                                               â”‚   â”‚
â”‚  â”‚  [APPROVE & PUBLISH] â† disabled until all suggestions handled                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  VERSION HISTORY                                                              â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚   â”‚
â”‚  â”‚                                                                               â”‚   â”‚
â”‚  â”‚  ğŸ“— v2 - PUBLISHED (Current)                                                  â”‚   â”‚
â”‚  â”‚     Published: Dec 5, 2024 by Max Mustermann                                  â”‚   â”‚
â”‚  â”‚     [VIEW CONTENT]                                                            â”‚   â”‚
â”‚  â”‚                                                                               â”‚   â”‚
â”‚  â”‚  ğŸ“• v1 - ARCHIVED                                                             â”‚   â”‚
â”‚  â”‚     Published: Oct 15, 2024 (Initial import)                                  â”‚   â”‚
â”‚  â”‚     [VIEW CONTENT]                                                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

When NO draft exists:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NO DRAFT IN PROGRESS                                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚                                                                               â”‚
â”‚  Create a new version to make changes to the published content.               â”‚
â”‚                                                                               â”‚
â”‚  [+ CREATE NEW VERSION]                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Page 3: Review Suggestions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Back to Project                                                                   â”‚
â”‚                                                                                      â”‚
â”‚  REVIEW SUGGESTIONS                                                    Version 3     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Progress: 15/23 handled                                                      â”‚   â”‚
â”‚  â”‚  [================================>                    ] 65%                  â”‚   â”‚
â”‚  â”‚                                                                               â”‚   â”‚
â”‚  â”‚  âš ï¸ 8 suggestions remaining - handle all to enable publishing                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                      â”‚
â”‚  [Pending (8)]  [Handled (15)]  [All (23)]                        [EDIT CONTENT]    â”‚
â”‚                                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  PENDING                                                                      â”‚   â”‚
â”‚  â”‚                                                                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  Open Question - Unit 1: EinfÃ¼hrung                                    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                                         â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  "What are the ethical challenges businesses face today?"              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                                         â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ ğŸ¤– AI Feedback                                                    â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ This question references ethical challenges but the learning      â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ cycle content doesn't cover business ethics. Consider adding      â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ ethics content to the cycle or adjusting the question.            â”‚  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚                                                                         â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  [âœ“ MARK AS FIXED]  [âœ— IGNORE]  [â†— EDIT IN FONTO]                      â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  Single Choice - Unit 2: Theorien                                      â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  ... more suggestions ...                                              â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                      â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
â”‚                                                                                      â”‚
â”‚  [RE-RUN CIA]                                              [APPROVE & PUBLISH]       â”‚
â”‚  (optional - if you made edits)                            (disabled: 8 remaining)   â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

When ALL suggestions handled (23/23):

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… All suggestions reviewed!                                                â”‚
â”‚                                                                               â”‚
â”‚  Summary:                                                                     â”‚
â”‚  â€¢ 18 marked as fixed                                                         â”‚
â”‚  â€¢ 5 ignored                                                                  â”‚
â”‚                                                                               â”‚
â”‚  You can now approve and publish this version.                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  [RE-RUN CIA]                                              [APPROVE & PUBLISH] âœ…
  (optional)                                                (enabled!)
```

### Approve & Publish Confirmation Modal

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                               [X]   â”‚
â”‚  APPROVE & PUBLISH                                                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                      â”‚
â”‚  You are about to publish version 3 of:                                              â”‚
â”‚  ğŸ“š DLBAGRMGDS01 - Grundlagen der deutschen Sprachwissenschaft                      â”‚
â”‚                                                                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                                      â”‚
â”‚  CIA Review Summary:                                                                 â”‚
â”‚  âœ“ 18 suggestions marked as fixed                                                    â”‚
â”‚  âœ— 5 suggestions ignored                                                             â”‚
â”‚                                                                                      â”‚
â”‚  This will publish to:                                                               â”‚
â”‚  â€¢ Moodle (KFK Questions)                                                            â”‚
â”‚  â€¢ S3 Archive                                                                        â”‚
â”‚                                                                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                                      â”‚
â”‚  â˜ I confirm this content has been reviewed and is ready for students               â”‚
â”‚                                                                                      â”‚
â”‚  âš ï¸ This will replace the current published version (v2).                            â”‚
â”‚                                                                                      â”‚
â”‚                              [CANCEL]              [PUBLISH NOW]                     â”‚
â”‚                                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”Œ Backend API Specification

### Version Management

```
POST   /courses/:courseId/versions
       Create new draft version (copies from latest published)
       
       Precondition: No existing draft for this course
       
       Side Effects:
         1. Creates new CourseVersion (status: DRAFT)
         2. Copies all KfkDocuments (new _id, same documentId)
         3. Copies all CoursebookDocuments (new _id, same documentId)
         4. Copies CIA suggestions where content unchanged (preserves status)
         5. S3 images: NOT copied (shared reference)
       
       Response: { 
         courseVersion,
         documentsCopied: { kfk: number, coursebook: number },
         suggestionsCopied: number
       }

GET    /courses/:courseId/versions
       List all versions for a course
       Response: { versions: [...], currentDraft?: {...} }

GET    /course-versions/:versionId
       Get specific version details
       Response: { courseVersion, suggestionProgress? }

DELETE /course-versions/:versionId
       Discard draft version (only if status = DRAFT or IN_REVIEW)
       Response: { success }
```

### CIA Review Flow

```
POST   /course-versions/:versionId/start-review
       Triggers CIA run, status â†’ IN_REVIEW
       Precondition: status = DRAFT
       Response: { courseVersion, ciaJobId }

POST   /course-versions/:versionId/re-run-cia
       Re-runs CIA, resets all suggestion statuses to 'pending'
       Precondition: status = IN_REVIEW
       Response: { courseVersion, ciaJobId }

GET    /course-versions/:versionId/suggestions
       Get all CIA suggestions with handling status
       Response: { 
         suggestions: [...],
         progress: { total, handled, pending }
       }

PATCH  /course-versions/:versionId/suggestions/:suggestionId
       Handle a suggestion
       Body: { status: 'fixed' | 'ignored', notes?: string }
       Response: { suggestion, progress }
```

### Publishing

```
POST   /course-versions/:versionId/publish
       Approve and start publishing
       Precondition: 
         - status = IN_REVIEW
         - all suggestions handled (pending = 0)
       Response: { publishingJobId, status: 'publishing' }

GET    /course-versions/:versionId/publish-status
       Get publishing job progress
       Response: {
         status: 'queued' | 'in_progress' | 'completed' | 'failed',
         progress?: { step, completedSteps },
         error?: string
       }

POST   /course-versions/:versionId/retry-publish
       Retry failed publishing
       Precondition: Previous publish failed
       Response: { publishingJobId }
```

---

## ğŸ”„ Version Creation Details

### What Happens on "Create New Version"

```
User clicks "Create New Version" (from published v1)
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. CREATE CourseVersion (v2)                                                         â”‚
â”‚    - _id: NEW ObjectId                                                               â”‚
â”‚    - versionNumber: v1.versionNumber + 1                                             â”‚
â”‚    - status: DRAFT                                                                   â”‚
â”‚    - baseVersionId: v1._id (track where we copied from)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. COPY Documents (KFK + Coursebook)                                                 â”‚
â”‚                                                                                      â”‚
â”‚    v1 Document                           v2 Document                                 â”‚
â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                     â”‚
â”‚    _id: K1                       â†’       _id: K1' (NEW ObjectId)                     â”‚
â”‚    documentId: "sf150-123.xml"           documentId: "sf150-123.xml" (SAME)          â”‚
â”‚    courseVersionId: v1._id               courseVersionId: v2._id                     â”‚
â”‚    contentHash: "abc123"                 contentHash: "abc123" (SAME)                â”‚
â”‚    xml: "<learningContent>..."           xml: "<learningContent>..." (copied)        â”‚
â”‚                                                                                      â”‚
â”‚    Key: documentId stays SAME, _id is NEW                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. COPY CIA Suggestions (Smart - only where content unchanged)                       â”‚
â”‚                                                                                      â”‚
â”‚    For each v1 suggestion:                                                           â”‚
â”‚                                                                                      â”‚
â”‚    IF v2.kfkDoc.contentHash === suggestion.kfkContentHash                            â”‚
â”‚    AND v2.cycleDoc.contentHash === suggestion.cycleContentHash                       â”‚
â”‚    THEN:                                                                             â”‚
â”‚      Copy suggestion to v2 WITH status preserved (fixed/ignored)                     â”‚
â”‚      Set copiedFromVersionId = v1._id                                                â”‚
â”‚    ELSE:                                                                             â”‚
â”‚      Don't copy - needs fresh CIA validation                                         â”‚
â”‚                                                                                      â”‚
â”‚    Result: Unchanged content keeps its "fixed" status! ğŸ‰                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. S3 Images: SHARE (don't copy)                                                     â”‚
â”‚                                                                                      â”‚
â”‚    v1 images at: s3://bucket/{courseCode}/{v1._id}/images/                           â”‚
â”‚    v2 references: SAME paths (no duplication)                                        â”‚
â”‚                                                                                      â”‚
â”‚    If user adds/changes images in v2:                                                â”‚
â”‚      New images go to: s3://bucket/{courseCode}/{v2._id}/images/                     â”‚
â”‚      Publishing will merge both folders                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### CIA Result Reuse Logic

CIA validates **pairs**: KFK Question â†” Coursebook Cycle

| v2 Question | v2 Cycle | Copy Suggestion? | Reason |
|-------------|----------|------------------|--------|
| Unchanged | Unchanged | âœ… Yes, with status | Both same, validation still valid |
| Changed | Unchanged | âŒ No | Question changed, need re-validate |
| Unchanged | Changed | âŒ No | Cycle changed, need re-validate |
| Changed | Changed | âŒ No | Both changed, need re-validate |

### User Experience After Version Creation

```
Scenario: MV creates v2 from v1, v1 had 23 suggestions (all handled)

v2 created:
â”œâ”€â”€ 20 questions unchanged â†’ 20 suggestions copied (status: "fixed" preserved!)
â””â”€â”€ 3 questions will be edited by user

User edits 3 questions, clicks "Start Review":
â”œâ”€â”€ CIA runs ONLY on 3 changed question-cycle pairs
â””â”€â”€ Creates 3 NEW suggestions (status: "pending")

User sees:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CIA Review Progress: 20/23 handled                                â”‚
â”‚  [================================>        ] 87%                   â”‚
â”‚                                                                    â”‚
â”‚  âœ… 20 suggestions carried over from v1 (already handled)          â”‚
â”‚  âš ï¸ 3 NEW suggestions need review                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

MV only reviews 3 new items, not all 23! ğŸ‰
```

### Storage Impact

| Content Type | Action | Impact |
|--------------|--------|--------|
| CourseVersion | Create new | ~1 KB |
| KFK Documents (~100-500) | Full copy | ~1-5 MB |
| Coursebook Documents (~50-200) | Full copy | ~1-4 MB |
| S3 Images | Shared (no copy) | 0 |
| CIA Suggestions | Smart copy | Minimal |
| **Total per version** | | ~2-9 MB |

---

## ğŸ“Š Data Model

### CourseVersion Schema (Extended)

```typescript
enum CourseVersionStatus {
  DRAFT = 'draft',
  IN_REVIEW = 'in_review',
  PUBLISHING = 'publishing',
  PUBLISHED = 'published',
  ARCHIVED = 'archived',
}

interface CourseVersion {
  _id: ObjectId;
  courseId: ObjectId;
  courseCode: string;
  versionNumber: number;           // 1, 2, 3...
  
  status: CourseVersionStatus;
  
  // Version lineage
  baseVersionId?: ObjectId;        // Which version this was copied from
  
  // CIA tracking
  ciaRunAt?: Date;                 // When CIA was last run
  ciaJobId?: string;               // Reference to CIA job
  // NOTE: No contentChangedAfterCia flag needed!
  // Detect changes by comparing document.contentHash vs CiaSuggestion hashes
  
  // Approval & Publishing (combined action)
  approvedBy?: string;             // iuUserId of MV who approved
  approvedAt?: Date;
  publishedAt?: Date;
  
  // Reference to publishing job
  lastPublishingJobId?: ObjectId;
  
  // Timestamps
  createdAt: Date;
  createdBy: string;
  updatedAt?: Date;
  updatedBy?: string;
}
```

### CiaSuggestion Schema (New Collection)

```typescript
enum SuggestionStatus {
  PENDING = 'pending',
  FIXED = 'fixed',
  IGNORED = 'ignored',
}

interface CiaSuggestion {
  _id: ObjectId;
  courseVersionId: ObjectId;       // FK to CourseVersion
  courseCode: string;              // Denormalized for queries
  
  // Question-Cycle pair (documentId, not _id!)
  kfkDocumentId: string;           // e.g., "sf150-123.xml"
  cycleDocumentId: string;         // e.g., "lc-001.xml"
  unitNumber: number;
  
  // Content hashes (for cache validation & smart copy)
  kfkContentHash: string;          // Hash of KFK doc when validated
  cycleContentHash: string;        // Hash of Cycle doc when validated
  
  // CIA result
  questionType: 'open' | 'single-choice' | 'multiple-choice';
  questionText: string;
  answerOptions?: string[];
  aiSuggestion: string;            // The AI feedback text
  
  // User handling
  status: SuggestionStatus;
  handledBy?: string;              // iuUserId
  handledAt?: Date;
  notes?: string;                  // Optional notes from MV
  
  // Tracking
  createdAt: Date;
  ciaRunId?: string;               // Which CIA run created this
  copiedFromVersionId?: ObjectId;  // If copied from previous version
  copiedFromSuggestionId?: ObjectId; // Original suggestion ID
}

// Indexes for efficient queries
CiaSuggestionSchema.index({ courseVersionId: 1, status: 1 });
CiaSuggestionSchema.index({ courseVersionId: 1, kfkDocumentId: 1, cycleDocumentId: 1 });
```

### Validation Logic for CIA Re-run

```typescript
/**
 * Determines if a question-cycle pair needs fresh CIA validation
 */
function shouldRunCiaForPair(
  existingSuggestion: CiaSuggestion | null,
  currentKfkHash: string,
  currentCycleHash: string
): boolean {
  // No existing suggestion â†’ need to validate
  if (!existingSuggestion) return true;
  
  // Content changed â†’ need fresh validation
  if (existingSuggestion.kfkContentHash !== currentKfkHash) return true;
  if (existingSuggestion.cycleContentHash !== currentCycleHash) return true;
  
  // Content unchanged â†’ existing suggestion is still valid
  return false;
}
```

### PublishingJob Schema (New Collection)

```typescript
enum PublishingJobStatus {
  QUEUED = 'queued',
  IN_PROGRESS = 'in_progress',
  COMPLETED = 'completed',
  FAILED = 'failed',
  PARTIAL_FAILURE = 'partial_failure',
}

enum TargetStatus {
  PENDING = 'pending',
  SUCCESS = 'success',
  FAILED = 'failed',
  SKIPPED = 'skipped',
}

interface PublishingJob {
  _id: ObjectId;
  courseVersionId: ObjectId;
  courseCode: string;
  versionNumber: number;
  
  status: PublishingJobStatus;
  
  // Lifecycle
  createdAt: Date;
  startedAt?: Date;
  completedAt?: Date;
  initiatedBy: string;             // iuUserId
  
  // Target results
  targets: {
    s3: {
      status: TargetStatus;
      s3Key?: string;
      error?: string;
    };
    moodle: {
      status: TargetStatus;
      responseData?: object;
      error?: string;
    };
    myCampus?: {                   // Future
      status: TargetStatus;
      error?: string;
    };
  };
  
  // Content snapshot (what was published)
  contentSnapshot: {
    kfkDocumentCount: number;
    coursebookDocumentCount: number;
    imageCount: number;
    zipFilename: string;
    zipSizeBytes: number;
  };
  
  // Error tracking
  errorMessage?: string;
  retryOf?: ObjectId;              // If this is a retry of a failed job
}
```

---

## ğŸ”„ Publishing Pipeline

### Pipeline Stages

```
START (user clicks "Approve & Publish")
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STAGE 0: PRE-FLIGHT CHECKS                                                        â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â–¡ Verify status = IN_REVIEW                                                       â”‚
â”‚ â–¡ Verify all suggestions handled (pending = 0)                                    â”‚
â”‚ â–¡ Verify no documents are locked by editors                                       â”‚
â”‚ â–¡ Check Moodle service is reachable                                               â”‚
â”‚                                                                                    â”‚
â”‚ ON FAILURE: Return error immediately, do not start job                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â”‚ All checks pass â†’ Create PublishingJob, set status = PUBLISHING
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STAGE 1: CONTENT ASSEMBLY                                                         â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â–¡ Retrieve KFK DITAMAP and documents                                              â”‚
â”‚ â–¡ Retrieve Coursebook DITAMAP and documents (future)                              â”‚
â”‚ â–¡ Retrieve images from S3                                                         â”‚
â”‚ â–¡ Validate DITAMAP references                                                     â”‚
â”‚ â–¡ Clean XML (remove Fonto processing instructions)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STAGE 2: ARCHIVE CREATION                                                         â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â–¡ Create KFK ZIP archive                                                          â”‚
â”‚ â–¡ Create Coursebook ZIP archive (future)                                          â”‚
â”‚ â–¡ Generate checksums for verification                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STAGE 3: S3 UPLOAD (Archive of Record - First!)                                   â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â–¡ Upload KFK ZIP to S3: {courseCode}/{versionId}/kfk-{date}-{id}.zip             â”‚
â”‚ â–¡ Verify upload with checksum                                                     â”‚
â”‚                                                                                    â”‚
â”‚ ON FAILURE: Abort entire job, status = FAILED                                     â”‚
â”‚ RATIONALE: S3 is our archive of record, must succeed first                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STAGE 4: MOODLE UPLOAD                                                            â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â–¡ Upload KFK ZIP to Moodle via API                                                â”‚
â”‚ â–¡ Verify response                                                                 â”‚
â”‚                                                                                    â”‚
â”‚ ON FAILURE: Mark job as PARTIAL_FAILURE (S3 succeeded, Moodle failed)             â”‚
â”‚ User can retry just the Moodle upload                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STAGE 5: FINALIZATION                                                             â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â–¡ Update CourseVersion:                                                           â”‚
â”‚   - status â†’ PUBLISHED                                                            â”‚
â”‚   - publishedAt = now()                                                           â”‚
â”‚ â–¡ Archive previous published version (status â†’ ARCHIVED)                          â”‚
â”‚ â–¡ Update PublishingJob: status â†’ COMPLETED                                        â”‚
â”‚ â–¡ Send notification to MV (optional)                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Failure Recovery

| Scenario | S3 | Moodle | Job Status | Recovery |
|----------|-----|--------|------------|----------|
| All succeed | âœ… | âœ… | COMPLETED | None needed |
| Moodle fails | âœ… | âŒ | PARTIAL_FAILURE | Retry Moodle only |
| S3 fails | âŒ | - | FAILED | Retry full pipeline |
| Pre-flight fails | - | - | (not started) | Fix issue, try again |

---

## ğŸ“± Frontend-Backend Integration

### API Calls by Page

#### Project List Page
```
On Mount:
  GET /courses/user-projects
  â†’ Returns courses with latestVersion info
```

#### Project Overview Page
```
On Mount:
  GET /courses/:courseId/versions
  â†’ Returns all versions + current draft (if exists)
  
  If draft exists and status = IN_REVIEW:
    GET /course-versions/:versionId/suggestions
    â†’ Returns progress (for progress bar)

On "Create New Version":
  POST /courses/:courseId/versions
  â†’ Creates draft, navigate to edit

On "Start Review":
  POST /course-versions/:versionId/start-review
  â†’ Triggers CIA, navigate to suggestions page

On "Edit Content":
  â†’ Opens Fonto editor
```

#### Review Suggestions Page
```
On Mount:
  GET /course-versions/:versionId/suggestions
  â†’ Returns all suggestions with status

On "Mark as Fixed" / "Ignore":
  PATCH /course-versions/:versionId/suggestions/:id
  Body: { status: 'fixed' | 'ignored' }
  â†’ Updates suggestion, returns new progress

On "Re-run CIA":
  POST /course-versions/:versionId/re-run-cia
  â†’ Resets suggestions, shows loading, then refreshes list

On "Approve & Publish":
  POST /course-versions/:versionId/publish
  â†’ Returns jobId, show progress modal
  
  Poll: GET /course-versions/:versionId/publish-status
  â†’ Until completed or failed
```

---

## ğŸ›¡ï¸ Authorization

| Action | MV (owns course) | Other Users | Admin |
|--------|-----------------|-------------|-------|
| View course | âœ… | âŒ | âœ… |
| Create version | âœ… | âŒ | âœ… |
| Edit content | âœ… | âŒ | âœ… |
| Start review | âœ… | âŒ | âœ… |
| Handle suggestions | âœ… | âŒ | âœ… |
| Approve & Publish | âœ… | âŒ | âœ… |

**Note**: MV has full autonomy over their courses - can review AND approve their own work.

---

## ğŸ“… Implementation Phases

### Phase 1: Version Management
- [ ] Add `versionNumber` to CourseVersion
- [ ] Update status enum (remove old, add new)
- [ ] Create version endpoint (copy content)
- [ ] Archive mechanism for old versions
- [ ] Frontend: Version history UI

### Phase 2: CIA Suggestion Tracking
- [ ] Create CiaSuggestion collection
- [ ] Populate suggestions when CIA completes
- [ ] Suggestion handling endpoints
- [ ] Frontend: Review suggestions page with actions

### Phase 3: Publishing Gateway
- [ ] Create PublishingJob collection
- [ ] Pre-flight checks before publish
- [ ] Refactor publishing service to use courseVersionId
- [ ] Partial failure handling
- [ ] Frontend: Publish confirmation modal, progress indicator

### Phase 4: Polish
- [ ] Re-run CIA functionality
- [ ] Content changed after CIA warning
- [ ] Error handling and retry UI
- [ ] Notifications

---

## âœ… Resolved Decisions

| Decision | Resolution | Date |
|----------|------------|------|
| Approval mechanism | Combined "Approve & Publish" button | Dec 2024 |
| Four-eyes principle | Not enforced - MV has full autonomy | Dec 2024 |
| Re-run CIA | Optional, available anytime during review | Dec 2024 |
| First import status | Imported as PUBLISHED (v1 baseline) | Dec 2024 |
| Draft limit | One draft per course at a time | Dec 2024 |
| Version creation | Full copy with new ObjectIds, same documentId | Dec 2024 |
| S3 images | Shared between versions (no copy) | Dec 2024 |
| CIA suggestion reuse | Copy if both question AND cycle content unchanged | Dec 2024 |

---

## ğŸ“ Open Questions

1. **MyCampus Integration**: What is the API specification for publishing Coursebook to MyCampus?

2. **Version Limit**: Should we limit how many archived versions to keep? (e.g., keep last 5)

3. **Discard Draft**: Should there be a "Discard Draft" action to abandon work on a draft?

4. **Audit Trail**: How long should PublishingJob records be retained?

---

**Version**: 2.0  
**Last Updated**: December 2024  
**Author**: Architecture Team

